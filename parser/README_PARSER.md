# Парсер вакансий HeadHunter

## Обзор
Парсер предназначен для сбора данных о вакансиях с сайта HeadHunter (hh.ru) через их API. Инструмент позволяет собирать, обрабатывать и анализировать информацию о вакансиях в IT-сфере.

## Основные возможности
- Многопоточный сбор данных (до 20 параллельных запросов)
- Поддержка кэширования для оптимизации запросов
- Автоматическая конвертация зарплат в рубли
- Сохранение результатов в CSV-формат
- Поддержка поиска по 20 IT-специальностям
- Поиск по 15 крупным городам России
- Обработка HTML-тегов в описаниях
- Защита от ограничений API (rate limiting)

## Требования
- Python 3.8+
- Установленные зависимости из requirements.txt
- Доступ к API HeadHunter

## Установка
1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```
3. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Конфигурация
Настройки хранятся в файле `settings.json`:

```json
{
  "options": {
    "text": "",                    // Поисковый запрос (опционально)
    "area": [1, 2, 3, ...],       // ID городов для поиска
    "per_page": 100,              // Вакансий на страницу (макс. 100)
    "professional_roles": [        // ID профессиональных ролей
      96,   // Программист, разработчик
      160,  // Руководитель разработки
      165,  // Руководитель проектов
      // ... и другие роли
    ],
    "list_roles": false           // Показывать список ролей
  },
  "refresh": true,                // Обновить кэш
  "num_workers": 20,              // Количество потоков
  "save_result": true,            // Сохранять результат
  "rates": {                      // Курсы валют
    "RUR": 1,
    "USD": null,
    "EUR": null
  }
}
```

## Использование

### Базовые команды
1. Показать список доступных профессиональных ролей:
```bash
python researcher.py --list_roles
```

2. Собрать вакансии с обновлением кэша:
```bash
python researcher.py --refresh --save_result
```

### Параметры командной строки
- `-t TEXT, --text TEXT` - Текст поискового запроса
- `-p [PROFESSIONAL_ROLES ...], --professional_roles [PROFESSIONAL_ROLES ...]` - Фильтр по профессиональным ролям
- `-n NUM_WORKERS, --num_workers NUM_WORKERS` - Количество потоков (по умолчанию: 20)
- `-r, --refresh` - Обновить кэшированные данные
- `-s, --save_result` - Сохранить результат в CSV
- `-u, --update` - Сохранить аргументы командной строки в JSON
- `-l, --list_roles` - Показать список доступных ролей

### Примеры использования командной строки

1. **Базовый поиск по тексту:**
```bash
python researcher.py --text "Python Developer"
```

2. **Поиск по конкретным ролям с обновлением кэша:**
```bash
python researcher.py --professional_roles 96 160 --refresh
```

3. **Полный поиск со всеми параметрами:**
```bash
python researcher.py --text "Data Scientist" --professional_roles 96 160 --num_workers 20 --refresh --save_result
```

4. **Просмотр доступных ролей:**
```bash
python researcher.py --list_roles
```

5. **Обновление настроек и сохранение результатов:**
```bash
python researcher.py --text "Java Developer" --update --save_result
```

### Важные замечания по использованию флагов

1. **Флаг `--refresh`**
   - Рекомендуется использовать при необходимости получения свежих данных
   - Обновляет кэшированные данные с API HeadHunter
   - Особенно важен при изменении параметров поиска

2. **Флаг `--num_workers`**
   - Контролирует количество параллельных запросов
   - Не рекомендуется превышать значение 20
   - Оптимальное значение зависит от скорости интернета
   - По умолчанию установлено на 20 потоков

3. **Флаг `--save_result`**
   - Сохраняет результаты в CSV-файл
   - Файл создается в текущей директории
   - Имя файла по умолчанию: `hh_results.csv`

4. **Флаг `--update`**
   - Сохраняет аргументы командной строки в `settings.json`
   - Полезно для сохранения часто используемых настроек
   - Перезаписывает существующие настройки в файле

5. **Флаг `--list_roles`**
   - Показывает список всех доступных профессиональных ролей
   - Выводит ID и названия ролей
   - Полезно для поиска нужных ID ролей

6. **Флаг `--professional_roles`**
   - Принимает список ID ролей через пробел
   - Можно указать несколько ролей
   - ID ролей можно получить через `--list_roles`

7. **Параметр `--text`**
   - Текст поискового запроса
   - Поддерживает сложные запросы
   - Можно использовать кавычки для фраз

### Рекомендации по комбинациям флагов

1. **Для первого запуска:**
```bash
python researcher.py --list_roles --refresh --save_result
```

2. **Для регулярного обновления данных:**
```bash
python researcher.py --refresh --save_result --num_workers 20
```

3. **Для поиска по конкретной специальности:**
```bash
python researcher.py --text "Python Developer" --professional_roles 96 --refresh --save_result
```

4. **Для сохранения настроек поиска:**
```bash
python researcher.py --text "Data Scientist" --professional_roles 96 160 --update
```

## Структура выходных данных
CSV-файл содержит следующие поля:
- `Ids` - ID вакансии
- `Employer` - Название компании
- `Name` - Название вакансии
- `Salary` - Наличие зарплаты
- `From` - Минимальная зарплата (в рублях)
- `To` - Максимальная зарплата (в рублях)
- `Experience` - Требуемый опыт
- `Schedule` - График работы
- `Keys` - Ключевые навыки
- `Description` - Описание вакансии

## Рекомендации по использованию

### Первый запуск
1. Запустите с флагом `--list_roles` для просмотра доступных ролей
2. Настройте `settings.json` под ваши потребности
3. Запустите с `--refresh` для получения актуальных данных

### Регулярное обновление
- Используйте `--refresh` для обновления данных
- Рекомендуется обновлять не чаще раза в сутки
- При большом количестве вакансий используйте `--num_workers 20`

### Оптимизация
- Увеличьте `num_workers` для ускорения сбора (до 20)
- Используйте кэширование для частых запросов
- Настройте фильтры в `settings.json` для уменьшения объема данных

## Устранение неполадок

### Частые проблемы
1. Ошибка "Too Many Requests"
   - Уменьшите `num_workers`
   - Добавьте задержку между запросами
   - Используйте кэширование

2. Пустые результаты
   - Проверьте настройки в `settings.json`
   - Убедитесь в доступности API
   - Проверьте фильтры поиска

3. Ошибки кэширования
   - Используйте `--refresh` для обновления кэша
   - Проверьте права доступа к директории кэша
   - Очистите кэш вручную при необходимости

## Для разработчиков

### Интеграция
- Используйте `DataCollector` для сбора данных
- `Analyzer` для обработки результатов
- `Settings` для управления конфигурацией

### Расширение функционала
1. Добавление новых полей:
   - Измените `__DICT_KEYS` в `DataCollector`
   - Обновите метод `get_vacancy`
   - Добавьте обработку в `Analyzer`

2. Новые источники данных:
   - Создайте новый класс коллектора
   - Реализуйте интерфейс `DataCollector`
   - Добавьте поддержку в `Analyzer`

## Лицензия и поддержка
- Лицензия: MIT
- Поддержка: через Issues в репозитории
- Обновления: следите за изменениями в коде

## Последние обновления
- Добавлена поддержка 20 IT-специальностей
- Расширен список городов до 15
- Улучшена обработка ошибок API
- Добавлена защита от rate limiting
- Оптимизирована работа с кэшем
- Улучшена обработка HTML в описаниях
- Добавлена конвертация всех валют в рубли
- Улучшена многопоточная обработка 